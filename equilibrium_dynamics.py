import functools
from backend import jnp, conditional_decorator, jit, use_jax, fori_loop, put, cross, dot, sign, pressfun, iotafun

@conditional_decorator(functools.partial(jit,static_argnums=(2)), use_jax)
def compute_coordinate_derivatives(cR,cZ,zernt):
    """Converts from spectral to real space and evaluates derivatives of R,Z wrt to SFL coords
    
    Args:
        cR (ndarray, shape(N_coeffs,)): spectral coefficients of R
        cZ (ndarray, shape(N_coeffs,)): spectral coefficients of Z
        zernt (ZernikeTransform): object with transform method to go from spectral to physical space with derivatives
    
    Returns:
        coordinate_derivatives (dict): dictionary of ndarray, shape(N_nodes,) of coordinate derivatives evaluated at node locations
    """
    # notation: X_y means derivative of X wrt y
    coordinate_derivatives = {}
    coordinate_derivatives['R'] = zernt.transform(cR,0,0,0)
    
    coordinate_derivatives['R_r'] = zernt.transform(cR,1,0,0)
    coordinate_derivatives['Z_r'] = zernt.transform(cZ,1,0,0)
    coordinate_derivatives['R_v'] = zernt.transform(cR,0,1,0)
    coordinate_derivatives['Z_v'] = zernt.transform(cZ,0,1,0)
    coordinate_derivatives['R_z'] = zernt.transform(cR,0,0,1)
    coordinate_derivatives['Z_z'] = zernt.transform(cZ,0,0,1)

    coordinate_derivatives['R_rr'] = zernt.transform(cR,2,0,0)
    coordinate_derivatives['Z_rr'] = zernt.transform(cZ,2,0,0)
    coordinate_derivatives['R_rv'] = zernt.transform(cR,1,1,0)
    coordinate_derivatives['Z_rv'] = zernt.transform(cZ,1,1,0)
    coordinate_derivatives['R_rz'] = zernt.transform(cR,1,0,1)
    coordinate_derivatives['Z_rz'] = zernt.transform(cZ,1,0,1)
    coordinate_derivatives['R_vv'] = zernt.transform(cR,0,2,0)
    coordinate_derivatives['Z_vv'] = zernt.transform(cZ,0,2,0)
    coordinate_derivatives['R_vz'] = zernt.transform(cR,0,1,1)
    coordinate_derivatives['Z_vz'] = zernt.transform(cZ,0,1,1)
    coordinate_derivatives['R_zz'] = zernt.transform(cR,0,0,2)
    coordinate_derivatives['Z_zz'] = zernt.transform(cZ,0,0,2)

    coordinate_derivatives['R_rrv'] = zernt.transform(cR,2,1,0)
    coordinate_derivatives['Z_rrv'] = zernt.transform(cZ,2,1,0)
    coordinate_derivatives['R_rvv'] = zernt.transform(cR,1,2,0)
    coordinate_derivatives['Z_rvv'] = zernt.transform(cZ,1,2,0)
    coordinate_derivatives['R_rvz'] = zernt.transform(cR,1,1,1)
    coordinate_derivatives['Z_rvz'] = zernt.transform(cZ,1,1,1)

    coordinate_derivatives['R_rrvv'] = zernt.transform(cR,2,2,0)
    coordinate_derivatives['Z_rrvv'] = zernt.transform(cZ,2,2,0)

    return coordinate_derivatives

@conditional_decorator(functools.partial(jit,static_argnums=(2,3,4,5,6,7)), use_jax)
def compute_accel_error_spectral(cR,cZ,zernt,nodes,pressfun_params,iotafun_params,Psi_total,volumes):
    """Computes acceleration error in spectral space
    
    Args:
        cR (ndarray, shape(N_coeffs,)): spectral coefficients of R
        cZ (ndarray, shape(N_coeffs,)): spectral coefficients of Z
        zernt (ZernikeTransform): object with tranform method to convert from spectral basis to physical basis at nodes
        nodes (ndarray, shape(3,N_nodes)): coordinates (r,v,z) of the collocation points
        pressfun_params (array-like): parameters to pass to pressure function
        iotafun_params (array-like): parameters to pass to rotational transform function
        Psi_total (float): total toroidal flux within LCFS
        volumes (ndarray, shape(3,N_nodes)): not used
        
    Returns:
        cR_zz_err (ndarray, shape(N_nodes,)): error in cR_zz
        cZ_zz_err (ndarray, shape(N_nodes,)): error in cZ_zz
    """
    
    mu0 = 4*jnp.pi*1e-7
    r = nodes[0]
    axn = jnp.where(r == 0)[0]
    presr = pressfun(r,1, pressfun_params)
    iota = iotafun(r,0, iotafun_params)
    iotar = iotafun(r,1, iotafun_params)
    
    coordinate_derivatives = compute_coordinate_derivatives(cR,cZ,zernt)
    
    R_zz = -(Psi_total**2*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']**2*r**2 + Psi_total**2*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_z']**2*r**2 - Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_r']*coordinate_derivatives['Z_v']**2*r + Psi_total**2*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_v']**4*r**2*iota**2 + Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_v']**2*r**2 + Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_vv']*coordinate_derivatives['Z_r']**2*r**2 - Psi_total**2*coordinate_derivatives['R']**2*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_v']**2*r**2 - Psi_total**2*coordinate_derivatives['R']**2*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']**2*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_v']**4*r*iota**2 + Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r + Psi_total**2*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_v']**2*r**2*iota**2 - coordinate_derivatives['R']**3*coordinate_derivatives['R_r']**3*coordinate_derivatives['Z_v']**4*mu0*jnp.pi**2*presr + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_v']**4*r**2*iota**2 + 2*Psi_total**2*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_v']**3*coordinate_derivatives['Z_z']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_v']**2*r - Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_vv']*r**2 + Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_r']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_v']*r**2 - 2*Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r**2 + Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_rv']*r**2 - Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_v']*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_v']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']**2*r + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rr']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_v']**2*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_vv']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_r']**2*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']**2*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_vv']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_z']**2*r**2 - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_v']**3*coordinate_derivatives['Z_z']*r*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rr']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_v']**2*r**2*iota**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_vv']*coordinate_derivatives['Z_v']**2*r**2*iota**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_vv']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_v']**2*r**2*iota**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_v']**3*coordinate_derivatives['Z_z']*r**2*iotar + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**3*r*iota**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**3*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r*iota**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_v']**3*coordinate_derivatives['Z_rz']*r**2*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_v']**3*coordinate_derivatives['Z_z']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**3*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_rz']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']**2*r + coordinate_derivatives['R']**3*coordinate_derivatives['R_v']**3*coordinate_derivatives['Z_r']**3*coordinate_derivatives['Z_v']*mu0*jnp.pi**2*presr - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_v']**4*r**2*iota*iotar - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_v']**2*r*iota**2 + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_vz']*coordinate_derivatives['Z_v']**2*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**3*r**2*iota**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_v']**3*r**2*iota**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**3*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_v']*r**2*iota**2 - 2*Psi_total**2*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**3*r**2*iota**2 + 2*Psi_total**2*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_z']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_v']**2*r**2 - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['R_vz']*coordinate_derivatives['Z_r']**2*r**2 + 2*Psi_total**2*coordinate_derivatives['R']**2*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_vv']*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_v']*r**2 - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_rv']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_v']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_rz']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_vz']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_vv']*coordinate_derivatives['Z_z']**2*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']**2*r**2 - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']**2*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_z']**2*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']**2*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rz']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_vz']*r**2 - 2*Psi_total**2*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']**2*r**2 - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']**2*r**2*iota**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**3*r**2*iota*iotar + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**3*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r**2*iota*iotar + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_v']*r**2*iota**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_vv']*r**2*iota**2 + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_v']**2*r**2*iota**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_vv']*r**2*iota**2 - 3*coordinate_derivatives['R']**3*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_v']**2*mu0*jnp.pi**2*presr - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']**2*r*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_v']**2*r**2*iota*iotar - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']**2*r**2*iotar + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r**2*iotar + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r**2*iotar - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']**2*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_v']**2*r**2*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rr']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']**2*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_vz']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_rv']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_rz']*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_v']*r**2*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_vz']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_vv']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_vz']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r**2*iota - 4*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_rz']*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_vz']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_vv']*coordinate_derivatives['Z_z']*r**2*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_vv']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r**2*iota - 4*Psi_total**2*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_vz']*r**2 + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_z']*coordinate_derivatives['R_vz']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_rz']*r**2 + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_vz']*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rz']*r**2 + 3*coordinate_derivatives['R']**3*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**3*mu0*jnp.pi**2*presr - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_vv']*r**2*iota + 3*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_v']*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_vz']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r**2*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_vv']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_vv']*coordinate_derivatives['Z_z']*r**2*iota + 3*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r**2*iota) / (Psi_total**2*coordinate_derivatives['R']*r**2*(coordinate_derivatives['R_r']*coordinate_derivatives['Z_v'] - coordinate_derivatives['R_v']*coordinate_derivatives['Z_r'])**2)
    Z_zz = (Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*r - Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_rr']*r**2 - Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_vv']*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**4*coordinate_derivatives['Z_r']*r*iota**2 - Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']*r + coordinate_derivatives['R']**3*coordinate_derivatives['R_v']**4*coordinate_derivatives['Z_r']**3*mu0*jnp.pi**2*presr - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**4*coordinate_derivatives['Z_rr']*r**2*iota**2 + Psi_total**2*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']**3*r**2*iota + Psi_total**2*coordinate_derivatives['R_v']**3*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_z']*r**2*iota - Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_r']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_v']*r**2 + 2*Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_rv']*r**2 + Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_r']*coordinate_derivatives['R_vv']*coordinate_derivatives['Z_r']*r**2 - Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_rv']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*r**2 + Psi_total**2*coordinate_derivatives['R']**3*coordinate_derivatives['R_rr']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_r']*r + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_z']**2*r + Psi_total**2*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']**3*r**2*iota**2 + Psi_total**2*coordinate_derivatives['R_v']**3*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_v']*r**2*iota**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_rr']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_vv']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_z']**2*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_vv']*coordinate_derivatives['Z_z']**2*r**2 + Psi_total**2*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r**2 + Psi_total**2*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_z']*r**2 + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**3*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*r*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_vv']*r**2*iota**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_v']**2*r**2*iota**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_vv']*r**2*iota**2 - 2*Psi_total**2*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*r**2*iota**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**3*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*r**2*iotar - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']**3*r*iota**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**3*coordinate_derivatives['Z_v']*r*iota**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_v']**3*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**3*coordinate_derivatives['R_z']*coordinate_derivatives['Z_rr']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**3*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_r']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_v']*r - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']**2*r - coordinate_derivatives['R']**3*coordinate_derivatives['R_r']**3*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']**3*mu0*jnp.pi**2*presr + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**4*coordinate_derivatives['Z_r']*r**2*iota*iotar + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**3*coordinate_derivatives['Z_rv']*r**2*iota**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rr']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']**3*r**2*iota**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rr']*coordinate_derivatives['R_v']**3*coordinate_derivatives['Z_v']*r**2*iota**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*r*iota**2 - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_vz']*r**2*iota + Psi_total**2*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r**2*iota + Psi_total**2*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_v']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_v']*r**2 + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_rv']*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_vv']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_r']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_r']*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rr']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_v']*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_r']*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_vz']*coordinate_derivatives['Z_v']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']**2*r**2 + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_z']**2*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_vv']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_z']**2*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_z']**2*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rr']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']**2*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['R_vz']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_z']*r**2 + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rz']*r**2 + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_vz']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']**3*r**2*iota*iotar - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**3*coordinate_derivatives['Z_v']*r**2*iota*iotar - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_v']*r**2*iota**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_v']*coordinate_derivatives['R_vv']*coordinate_derivatives['Z_v']*r**2*iota**2 - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*r**2*iota**2 + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['R_vv']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_v']*r**2*iota**2 + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_v']*r**2*iota**2 + 3*coordinate_derivatives['R']**3*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*mu0*jnp.pi**2*presr - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']*r*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*r**2*iota*iotar - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']*r**2*iotar - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r**2*iotar + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r**2*iotar + 4*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_rv']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_vz']*coordinate_derivatives['Z_r']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_v']*r**2*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rr']*coordinate_derivatives['R_v']**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_vv']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_v']*coordinate_derivatives['R_vz']*coordinate_derivatives['Z_v']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R_vv']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_vz']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_rz']*r**2*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rr']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']**2*coordinate_derivatives['Z_z']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['R_vv']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_z']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['R_vz']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_v']*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']**2*r**2*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_z']*r**2*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_rz']*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r**2*iota - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['R_vz']*coordinate_derivatives['Z_r']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_v']*r**2 - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_vz']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_vz']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r**2 - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rz']*r**2 - Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_v']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r**2 - 2*Psi_total**2*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r**2 - 3*coordinate_derivatives['R']**3*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']**3*coordinate_derivatives['Z_r']**2*coordinate_derivatives['Z_v']*mu0*jnp.pi**2*presr - 3*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_v']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_v']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['R_vv']*coordinate_derivatives['R_z']*coordinate_derivatives['Z_r']*r**2*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_vz']*r**2*iota - 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_vv']*coordinate_derivatives['Z_z']*r**2*iota + 2*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r**2*iota + Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_r']*coordinate_derivatives['R_vv']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r**2*iota - 3*Psi_total**2*coordinate_derivatives['R']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_v']*coordinate_derivatives['Z_r']*coordinate_derivatives['Z_v']*coordinate_derivatives['Z_z']*r**2*iota) / (Psi_total**2*coordinate_derivatives['R']*r**2*(coordinate_derivatives['R_r']*coordinate_derivatives['Z_v'] - coordinate_derivatives['R_v']*coordinate_derivatives['Z_r'])**2)
    
    put(R_zz,axn,(24*Psi_total**2*coordinate_derivatives['R_rv']**2*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R']**2 - 24*Psi_total**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rv']**2*coordinate_derivatives['R_r']**2 - 24*Psi_total**2*coordinate_derivatives['R_rv']**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_r']**2 + 24*Psi_total**2*coordinate_derivatives['Z_rv']**2*coordinate_derivatives['R_r']**2*coordinate_derivatives['R']**2 - 24*Psi_total**2*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_rv']**2*coordinate_derivatives['R']**3 - 12*Psi_total**2*coordinate_derivatives['R_rrvv']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R']**3 + 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_r'] - 24*Psi_total**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']**2 - 12*Psi_total**2*coordinate_derivatives['R_rrvv']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_r'] - 72*Psi_total**2*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R']**2 + 72*Psi_total**2*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['R']**2 + 12*Psi_total**2*coordinate_derivatives['Z_rrvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R']**3 + 24*Psi_total**2*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R']**3 + 24*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R']**3 - 12*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rrv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R']**3 - 48*Psi_total**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['R_rvv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R']**3 + 24*Psi_total**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['R']**3 + 24*Psi_total**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rrv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R']**3 - 12*Psi_total**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_rrv']*coordinate_derivatives['R_r']*coordinate_derivatives['R']**3 - 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_rv']**2*coordinate_derivatives['R'] - 24*Psi_total**2*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rv']**2*coordinate_derivatives['R'] - 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']**2 - 12*Psi_total**2*coordinate_derivatives['R_rrvv']*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*iota*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']**3*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 12*Psi_total**2*coordinate_derivatives['Z_rrvv']*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 48*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_rvz']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rz']*coordinate_derivatives['R_rvv']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R'] - 12*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rrv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['R_rvv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rrv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 12*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_rrv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 48*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r'] + 12*Psi_total**2*coordinate_derivatives['Z_rrvv']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_rvz']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rvv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R'] - 12*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rrv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['R_rvv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rrv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 12*Psi_total**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_rrv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rvz']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rz']*coordinate_derivatives['R_rvv']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R']**2 + 48*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_rv']**2*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']**2*coordinate_derivatives['Z_rz']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']**2*coordinate_derivatives['Z_rz']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 24*Psi_total**2*iota*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rv']**2*coordinate_derivatives['R_r']*coordinate_derivatives['R'] - 24*Psi_total**2*iota*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 24*Psi_total**2*iota*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 24*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_rz']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] - 24*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rvz']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 48*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rvz']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 24*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_rz']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 24*Psi_total**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_rvz']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 48*Psi_total**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rz']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*iota*coordinate_derivatives['R_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*iota*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R'] - 48*Psi_total**2*iota*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rvv']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*iota*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 48*Psi_total**2*iota*coordinate_derivatives['R_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*iota*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R']) / (24*Psi_total**2*(coordinate_derivatives['R_rv']*coordinate_derivatives['Z_r'] - coordinate_derivatives['Z_rv']*coordinate_derivatives['R_r'])**2*coordinate_derivatives['R']))
    put(Z_zz,axn,(24*Psi_total**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_r'] - 24*Psi_total**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']**3 - 24*Psi_total**2*coordinate_derivatives['R_rv']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['R']**3 - 72*Psi_total**2*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']**3*coordinate_derivatives['R']**2 - 12*Psi_total**2*coordinate_derivatives['Z_rrvv']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R']**3 - 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']**3 - 12*Psi_total**2*coordinate_derivatives['Z_rrvv']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['R_r']**2*coordinate_derivatives['R'] + 72*Psi_total**2*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_r']*coordinate_derivatives['R']**2 + 12*Psi_total**2*coordinate_derivatives['R_rrvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R']**3 + 24*Psi_total**2*coordinate_derivatives['R_rr']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R']**3 + 24*Psi_total**2*coordinate_derivatives['R_rr']*coordinate_derivatives['R_rvv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R']**3 - 48*Psi_total**2*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['R']**3 - 12*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['R_rrv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R']**3 + 24*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rrv']*coordinate_derivatives['R_r']*coordinate_derivatives['R']**3 + 24*Psi_total**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['R']**3 - 12*Psi_total**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rrv']*coordinate_derivatives['R_r']*coordinate_derivatives['R']**3 - 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_rv']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['R'] - 24*Psi_total**2*coordinate_derivatives['R_rv']**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']**2*coordinate_derivatives['Z_r'] + 24*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']**2*coordinate_derivatives['R_r']**2 + 24*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_r']**2 - 12*Psi_total**2*coordinate_derivatives['Z_rrvv']*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*iota*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']**3*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 12*Psi_total**2*coordinate_derivatives['R_rrvv']*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_rr']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_rr']*coordinate_derivatives['R_rvv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] - 12*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_rv']*coordinate_derivatives['R_rrv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rrv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] - 12*Psi_total**2*coordinate_derivatives['R_z']**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rrv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 12*Psi_total**2*coordinate_derivatives['R_rrvv']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rvz']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_rr']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['R_rvv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['R_rr']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] - 12*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['R_rrv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rrv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rr']*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] - 12*Psi_total**2*coordinate_derivatives['Z_z']**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rrv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']*coordinate_derivatives['R_rvz']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R'] + 48*Psi_total**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_rvz']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rz']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']**2*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*coordinate_derivatives['Z_z']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_rv']**2*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 48*Psi_total**2*coordinate_derivatives['R_rv']**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rz']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r'] - 24*Psi_total**2*iota*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']**2*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] - 24*Psi_total**2*iota*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']**2*coordinate_derivatives['R_r']*coordinate_derivatives['R'] + 24*Psi_total**2*iota*coordinate_derivatives['R_rv']**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 24*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] - 24*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_rvz']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 48*Psi_total**2*coordinate_derivatives['R_z']*coordinate_derivatives['R_rz']*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 24*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']*coordinate_derivatives['R_rz']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['Z_rz']*coordinate_derivatives['R_r']*coordinate_derivatives['R'] - 48*Psi_total**2*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rvz']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 24*Psi_total**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rvz']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 48*Psi_total**2*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rz']*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 48*Psi_total**2*iota*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*iota*coordinate_derivatives['R_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*iota*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']*coordinate_derivatives['R_rvv']*coordinate_derivatives['Z_r']**2*coordinate_derivatives['R'] + 24*Psi_total**2*iota*coordinate_derivatives['R_z']*coordinate_derivatives['R_rv']*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] - 48*Psi_total**2*iota*coordinate_derivatives['R_rv']*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R'] + 24*Psi_total**2*iota*coordinate_derivatives['Z_z']*coordinate_derivatives['Z_rv']*coordinate_derivatives['R_rvv']*coordinate_derivatives['R_r']*coordinate_derivatives['Z_r']*coordinate_derivatives['R']) / (24*Psi_total**2*(coordinate_derivatives['R_rv']*coordinate_derivatives['Z_r'] - coordinate_derivatives['Z_rv']*coordinate_derivatives['R_r'])**2*coordinate_derivatives['R']))
    
    R_zz_err = coordinate_derivatives['R_zz'] - R_zz
    Z_zz_err = coordinate_derivatives['Z_zz'] - Z_zz
    
    cR_zz_err = zernt.fit(R_zz_err)
    cZ_zz_err = zernt.fit(Z_zz_err)
    
    return cR_zz_err,cZ_zz_err
